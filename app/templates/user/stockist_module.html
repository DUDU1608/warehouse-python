<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <title>‡§∏‡•ç‡§ü‡•â‡§ï‡§ø‡§∏‡•ç‡§ü ‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§°</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap 5 CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background-color: #f5f8fa; }
    .card { border-radius: 10px; }
    .lang-wrap { display:flex; justify-content:flex-end; align-items:center; gap:.5rem; }
    .small-muted { font-size:.875rem; color:#6c757d; }
    .table thead th { white-space: nowrap; }
  </style>
</head>
<body>
<div class="container mt-4 mb-5">

  <!-- Top bar: Back + Language -->
  <div class="mb-3 lang-wrap">
    <a href="{{ url_for('user_views.home') }}" class="btn btn-outline-secondary"
       data-hi="‚Üê ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§™‡•É‡§∑‡•ç‡§† ‡§™‡§∞ ‡§µ‡§æ‡§™‡§∏ ‡§ú‡§æ‡§è‡§Å"
       data-en="‚Üê Back to Home">‚Üê ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§™‡•É‡§∑‡•ç‡§† ‡§™‡§∞ ‡§µ‡§æ‡§™‡§∏ ‡§ú‡§æ‡§è‡§Å</a>

    <select id="langSwitcher" class="form-select form-select-sm" style="width:auto">
      <option value="hi" selected>‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
      <option value="en">English</option>
    </select>
  </div>

  <h2 class="mb-4 text-center fw-bold text-primary"
      data-hi="üì¶ ‡§∏‡•ç‡§ü‡•â‡§ï‡§ø‡§∏‡•ç‡§ü ‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§°"
      data-en="üì¶ Stockist Dashboard">üì¶ ‡§∏‡•ç‡§ü‡•â‡§ï‡§ø‡§∏‡•ç‡§ü ‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§°</h2>

  <!-- Nav Tabs -->
  <ul class="nav nav-tabs mb-4" id="stockistTabs" role="tablist">
    <li class="nav-item">
      <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#materials" type="button"
              data-hi="üì¶ ‡§Æ‡•á‡§∞‡•á ‡§∏‡§Ç‡§ó‡•ç‡§∞‡§π‡§ø‡§§ ‡§∏‡§æ‡§Æ‡§ó‡•ç‡§∞‡•Ä"
              data-en="üì¶ My Materials Stored">üì¶ ‡§Æ‡•á‡§∞‡•á ‡§∏‡§Ç‡§ó‡•ç‡§∞‡§π‡§ø‡§§ ‡§∏‡§æ‡§Æ‡§ó‡•ç‡§∞‡•Ä</button>
    </li>
    <li class="nav-item">
      <button class="nav-link" data-bs-toggle="tab" data-bs-target="#loans" type="button"
              data-hi="üí∞ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ã‡§£"
              data-en="üí∞ Loans Received">üí∞ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ã‡§£</button>
    </li>
    <li class="nav-item">
      <button class="nav-link" data-bs-toggle="tab" data-bs-target="#margins" type="button"
              data-hi="üìâ ‡§¶‡•Ä ‡§ó‡§à ‡§Æ‡§æ‡§∞‡•ç‡§ú‡§ø‡§®"
              data-en="üìâ Margins Paid">üìâ ‡§¶‡•Ä ‡§ó‡§à ‡§Æ‡§æ‡§∞‡•ç‡§ú‡§ø‡§®</button>
    </li>
    <li class="nav-item">
      <button class="nav-link" data-bs-toggle="tab" data-bs-target="#rental" type="button"
              data-hi="üè¢ ‡§ó‡•ã‡§¶‡§æ‡§Æ ‡§ï‡§ø‡§∞‡§æ‡§Ø‡§æ ‡§¶‡•á‡§Ø"
              data-en="üè¢ Rental Due">üè¢ ‡§ó‡•ã‡§¶‡§æ‡§Æ ‡§ï‡§ø‡§∞‡§æ‡§Ø‡§æ ‡§¶‡•á‡§Ø</button>
    </li>
    <li class="nav-item">
      <button class="nav-link" data-bs-toggle="tab" data-bs-target="#interest" type="button"
              data-hi="üí∏ ‡§¨‡•ç‡§Ø‡§æ‡§ú ‡§¶‡•á‡§Ø"
              data-en="üí∏ Interest Due">üí∏ ‡§¨‡•ç‡§Ø‡§æ‡§ú ‡§¶‡•á‡§Ø</button>
    </li>
  </ul>

  <div class="tab-content">
    <!-- My Materials Stored -->
    <div class="tab-pane fade show active" id="materials">
      <!-- Net summary cards (backward-compatible: uses material_summary) -->
      <h5 class="text-success fw-semibold mb-3"
          data-hi="üìã ‡§®‡•á‡§ü ‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂ (‡§è‡§Æ‡§ü‡•Ä ‡§Æ‡•á‡§Ç)"
          data-en="üìã Net Summary (in MT)">üìã ‡§®‡•á‡§ü ‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂ (‡§è‡§Æ‡§ü‡•Ä ‡§Æ‡•á‡§Ç)</h5>

      <div class="row">
        {% for wh, data in material_summary.items() %}
        <div class="col-md-4 mb-3">
          <div class="card border-primary shadow-sm h-100">
            <div class="card-body">
              <h6 class="card-title text-primary fw-bold">{{ wh | to_hindi }}</h6>
              {% for com, qty in data.items() %}
                <p class="mb-1">{{ com }} ‚Äî <strong>{{ '%.2f' % qty }} MT</strong></p>
              {% endfor %}
            </div>
          </div>
        </div>
        {% endfor %}
        {% if not material_summary %}
        <div class="col-12"><p class="text-muted small">‡§ï‡•ã‡§à ‡§°‡•á‡§ü‡§æ ‡§®‡§π‡•Ä‡§Ç / No data.</p></div>
        {% endif %}
      </div>

      <!-- In/Out/Net summary table (uses material_io) -->
      <h5 class="mt-4 text-secondary fw-semibold"
          data-hi="‚ÜïÔ∏è ‡§Ü‡§®‡•á-‡§ú‡§æ‡§®‡•á ‡§ï‡§æ ‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂ (‡§è‡§Æ‡§ü‡•Ä)"
          data-en="‚ÜïÔ∏è In/Out Summary (MT)">‚ÜïÔ∏è ‡§Ü‡§®‡•á-‡§ú‡§æ‡§®‡•á ‡§ï‡§æ ‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂ (‡§è‡§Æ‡§ü‡•Ä)</h5>

      <div class="table-responsive">
        <table class="table table-bordered table-striped table-hover small align-middle">
          <thead class="table-dark">
            <tr>
              <th data-hi="‡§µ‡•á‡§Ø‡§∞‡§π‡§æ‡§â‡§∏" data-en="Warehouse">‡§µ‡•á‡§Ø‡§∞‡§π‡§æ‡§â‡§∏</th>
              <th data-hi="‡§µ‡§∏‡•ç‡§§‡•Å" data-en="Commodity">‡§µ‡§∏‡•ç‡§§‡•Å</th>
              <th data-hi="‡§á‡§® (MT)" data-en="IN (MT)">‡§á‡§® (MT)</th>
              <th data-hi="‡§Ü‡§â‡§ü (MT)" data-en="OUT (MT)">‡§Ü‡§â‡§ü (MT)</th>
              <th data-hi="‡§®‡•á‡§ü (MT)" data-en="NET (MT)">‡§®‡•á‡§ü (MT)</th>
              <th data-hi="‡§Ö‡§Ç‡§§‡§ø‡§Æ ‡§á‡§® ‡§§‡§ø‡§•‡§ø" data-en="Last IN Date">‡§Ö‡§Ç‡§§‡§ø‡§Æ ‡§á‡§® ‡§§‡§ø‡§•‡§ø</th>
              <th data-hi="‡§Ö‡§Ç‡§§‡§ø‡§Æ ‡§Ü‡§â‡§ü ‡§§‡§ø‡§•‡§ø" data-en="Last OUT Date">‡§Ö‡§Ç‡§§‡§ø‡§Æ ‡§Ü‡§â‡§ü ‡§§‡§ø‡§•‡§ø</th>
            </tr>
          </thead>
          <tbody>
            {% for wh, com_map in material_io.items() %}
              {% for com, r in com_map.items() %}
              <tr>
                <td>{{ wh | to_hindi }}</td>
                <td>{{ com | to_hindi }}</td>
                <td>{{ '%.3f'|format(r.in_mt) }}</td>
                <td>{{ '%.3f'|format(r.out_mt) }}</td>
                <td class="fw-semibold">{{ '%.3f'|format(r.net_mt) }}</td>
                <td>{{ r.last_in|format_date if r.last_in else '‚Äî' }}</td>
                <td>{{ r.last_out|format_date if r.last_out else '‚Äî' }}</td>
              </tr>
              {% endfor %}
            {% endfor %}
            {% if not material_io %}
            <tr><td colspan="7" class="text-center text-muted">‡§ï‡•ã‡§à ‡§°‡•á‡§ü‡§æ ‡§®‡§π‡•Ä‡§Ç / No data.</td></tr>
            {% endif %}
          </tbody>
        </table>
      </div>

      <!-- Detailed IN entries (StockData) -->
      <h5 class="mt-4 text-secondary fw-semibold"
          data-hi="üìÑ ‡§µ‡§ø‡§∏‡•ç‡§§‡•É‡§§ ‡§™‡•ç‡§∞‡§µ‡§ø‡§∑‡•ç‡§ü‡§ø‡§Ø‡§æ‡§Å ‚Äî ‡§á‡§® (Stock IN)"
          data-en="üìÑ Detailed Entries ‚Äî IN (Stock IN)">üìÑ ‡§µ‡§ø‡§∏‡•ç‡§§‡•É‡§§ ‡§™‡•ç‡§∞‡§µ‡§ø‡§∑‡•ç‡§ü‡§ø‡§Ø‡§æ‡§Å ‚Äî ‡§á‡§® (Stock IN)</h5>

      <div class="table-responsive">
        <table class="table table-bordered table-striped table-hover small">
          <thead class="table-dark">
             <tr>
               <th data-hi="‡§§‡§ø‡§•‡§ø" data-en="Date">‡§§‡§ø‡§•‡§ø</th>
               <th data-hi="‡§µ‡•á‡§Ø‡§∞‡§π‡§æ‡§â‡§∏" data-en="Warehouse">‡§µ‡•á‡§Ø‡§∞‡§π‡§æ‡§â‡§∏</th>
               <th data-hi="‡§Ü‡§∞‡§è‡§∏‡§ü‡•Ä ‡§®‡§Ç." data-en="RST No">‡§Ü‡§∞‡§è‡§∏‡§ü‡•Ä ‡§®‡§Ç.</th>
               <th data-hi="‡§µ‡§∏‡•ç‡§§‡•Å" data-en="Commodity">‡§µ‡§∏‡•ç‡§§‡•Å</th>
               <th data-hi="‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ (‡§ï‡§ø‡§ó‡•ç‡§∞‡§æ)" data-en="Quantity (kg)">‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ (‡§ï‡§ø‡§ó‡•ç‡§∞‡§æ)</th>
               <th data-hi="‡§ó‡•Å‡§£‡§µ‡§§‡•ç‡§§‡§æ" data-en="Quality">‡§ó‡•Å‡§£‡§µ‡§§‡•ç‡§§‡§æ</th>
            </tr>
          </thead>
          <tbody>
            {% for entry in stock_data %}
            <tr>
              <td>{{ entry.date | format_date }}</td>
              <td>{{ entry.warehouse | to_hindi }}</td>
              <td>{{ entry.rst_no }}</td>
              <td>{{ entry.commodity | to_hindi }}</td>
              <td>{{ entry.quantity or 0 }}</td>
              <td>{{ entry.quality }}</td>
            </tr>
            {% endfor %}
            {% if not stock_data %}
            <tr><td colspan="6" class="text-center text-muted">‡§ï‡•ã‡§à IN ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§®‡§π‡•Ä‡§Ç / No IN entries.</td></tr>
            {% endif %}
          </tbody>
        </table>
      </div>

      <!-- Detailed EXIT entries (StockExit) -->
      <h5 class="mt-4 text-secondary fw-semibold"
          data-hi="üìÑ ‡§µ‡§ø‡§∏‡•ç‡§§‡•É‡§§ ‡§™‡•ç‡§∞‡§µ‡§ø‡§∑‡•ç‡§ü‡§ø‡§Ø‡§æ‡§Å ‚Äî ‡§Ü‡§â‡§ü (Stock EXIT)"
          data-en="üìÑ Detailed Entries ‚Äî OUT (Stock EXIT)">üìÑ ‡§µ‡§ø‡§∏‡•ç‡§§‡•É‡§§ ‡§™‡•ç‡§∞‡§µ‡§ø‡§∑‡•ç‡§ü‡§ø‡§Ø‡§æ‡§Å ‚Äî ‡§Ü‡§â‡§ü (Stock EXIT)</h5>

      <div class="table-responsive">
        <table class="table table-bordered table-striped table-hover small">
          <thead class="table-dark">
            <tr>
              <th data-hi="‡§§‡§ø‡§•‡§ø" data-en="Date">‡§§‡§ø‡§•‡§ø</th>
              <th data-hi="‡§µ‡•á‡§Ø‡§∞‡§π‡§æ‡§â‡§∏" data-en="Warehouse">‡§µ‡•á‡§Ø‡§∞‡§π‡§æ‡§â‡§∏</th>
              <th data-hi="‡§µ‡§∏‡•ç‡§§‡•Å" data-en="Commodity">‡§µ‡§∏‡•ç‡§§‡•Å</th>
              <th data-hi="‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ (‡§ï‡§ø‡§ó‡•ç‡§∞‡§æ)" data-en="Quantity (kg)">‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ (‡§ï‡§ø‡§ó‡•ç‡§∞‡§æ)</th>
              <th data-hi="‡§∞‡§ø‡§°‡§ï‡•ç‡§∂‡§® (‡§ï‡§ø‡§ó‡•ç‡§∞‡§æ)" data-en="Reduction (kg)">‡§∞‡§ø‡§°‡§ï‡•ç‡§∂‡§® (‡§ï‡§ø‡§ó‡•ç‡§∞‡§æ)</th>
              <th data-hi="‡§®‡•á‡§ü ‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ (‡§ï‡§ø‡§ó‡•ç‡§∞‡§æ)" data-en="Net Qty (kg)">‡§®‡•á‡§ü ‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ (‡§ï‡§ø‡§ó‡•ç‡§∞‡§æ)</th>
              <th data-hi="‡§ó‡•Å‡§£‡§µ‡§§‡•ç‡§§‡§æ" data-en="Quality">‡§ó‡•Å‡§£‡§µ‡§§‡•ç‡§§‡§æ</th>
            </tr>
          </thead>
          <tbody>
            {% if stock_out_list is defined %}
              {% for entry in stock_out_list %}
              <tr>
                <td>{{ entry.date | format_date }}</td>
                <td>{{ entry.warehouse | to_hindi }}</td>
                <td>{{ entry.commodity | to_hindi }}</td>
                <td>{{ entry.quantity or 0 }}</td>
                <td>{{ entry.reduction or 0 }}</td>
                <td>{{ entry.net_qty or 0 }}</td>
                <td>{{ entry.quality or '' }}</td>
              </tr>
              {% endfor %}
              {% if not stock_out_list %}
              <tr><td colspan="7" class="text-center text-muted">‡§ï‡•ã‡§à OUT ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§®‡§π‡•Ä‡§Ç / No OUT entries.</td></tr>
              {% endif %}
            {% else %}
              <tr>
                <td colspan="7" class="text-center text-muted">
                  <span class="small-muted">NOTE: Template expects <code>stock_out_list</code> in context for Stock EXIT details.</span>
                </td>
              </tr>
            {% endif %}
          </tbody>
        </table>
      </div>
    </div>

    <!-- Loans Received -->
    <div class="tab-pane fade" id="loans">
      <h5 class="text-success fw-semibold mb-3"
          data-hi="üìã ‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂"
          data-en="üìã Summary">üìã ‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂</h5>

      <div class="row">
        {% for wh, data in loan_summary.items() %}
        <div class="col-md-4 mb-3">
          <div class="card border-success shadow-sm h-100">
            <div class="card-body">
              <h6 class="card-title text-success fw-bold">{{ wh | to_hindi }}</h6>
              <p class="mb-1" data-hi="‡§ï‡•Å‡§≤ ‡§®‡§ï‡§¶ ‡§ã‡§£ ‚Äî {{ data.cash | format_inr }}" data-en="Total Cash Loan ‚Äî {{ data.cash | format_inr }}">
                ‡§ï‡•Å‡§≤ ‡§®‡§ï‡§¶ ‡§ã‡§£ ‚Äî {{ data.cash | format_inr }}
              </p>
              <p class="mb-1" data-hi="‡§ï‡•Å‡§≤ ‡§Æ‡§æ‡§∞‡•ç‡§ú‡§ø‡§® ‡§ã‡§£ ‚Äî {{ data.margin | format_inr }}" data-en="Total Margin Loan ‚Äî {{ data.margin | format_inr }}">
                ‡§ï‡•Å‡§≤ ‡§Æ‡§æ‡§∞‡•ç‡§ú‡§ø‡§® ‡§ã‡§£ ‚Äî {{ data.margin | format_inr }}
              </p>
              <p class="mb-0 fw-semibold" data-hi="‡§ï‡•Å‡§≤ ‡§ã‡§£ ‚Äî {{ (data.cash + data.margin) | format_inr }}" data-en="Total Loan ‚Äî {{ (data.cash + data.margin) | format_inr }}">
                ‡§ï‡•Å‡§≤ ‡§ã‡§£ ‚Äî {{ (data.cash + data.margin) | format_inr }}
              </p>
            </div>
          </div>
        </div>
        {% endfor %}
        {% if not loan_summary %}
        <div class="col-12"><p class="text-muted small">‡§ï‡•ã‡§à ‡§°‡•á‡§ü‡§æ ‡§®‡§π‡•Ä‡§Ç / No data.</p></div>
        {% endif %}
      </div>

      <h5 class="mt-4 text-secondary fw-semibold"
          data-hi="üìÑ ‡§µ‡§ø‡§∏‡•ç‡§§‡•É‡§§ ‡§™‡•ç‡§∞‡§µ‡§ø‡§∑‡•ç‡§ü‡§ø‡§Ø‡§æ‡§Å"
          data-en="üìÑ Detailed Entries">üìÑ ‡§µ‡§ø‡§∏‡•ç‡§§‡•É‡§§ ‡§™‡•ç‡§∞‡§µ‡§ø‡§∑‡•ç‡§ü‡§ø‡§Ø‡§æ‡§Å</h5>

      <div class="table-responsive">
        <table class="table table-bordered table-striped table-hover small">
          <thead class="table-dark">
            <tr>
              <th data-hi="‡§§‡§ø‡§•‡§ø" data-en="Date">‡§§‡§ø‡§•‡§ø</th>
              <th data-hi="‡§µ‡•á‡§Ø‡§∞‡§π‡§æ‡§â‡§∏" data-en="Warehouse">‡§µ‡•á‡§Ø‡§∞‡§π‡§æ‡§â‡§∏</th>
              <th data-hi="‡§µ‡§∏‡•ç‡§§‡•Å" data-en="Commodity">‡§µ‡§∏‡•ç‡§§‡•Å</th>
              <th data-hi="‡§ã‡§£ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞" data-en="Loan Type">‡§ã‡§£ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞</th>
              <th data-hi="‡§∞‡§æ‡§∂‡§ø" data-en="Amount">‡§∞‡§æ‡§∂‡§ø</th>
            </tr>
          </thead>
          <tbody>
            {% for entry in loan_data %}
            <tr>
              <td>{{ entry.date | format_date }}</td>
              <td>{{ entry.warehouse | to_hindi }}</td>
              <td>{{ entry.commodity | to_hindi }}</td>
              <td>{{ entry.loan_type | to_hindi }}</td>
              <td>{{ entry.amount | format_inr }}</td>
            </tr>
            {% endfor %}
            {% if not loan_data %}
            <tr><td colspan="5" class="text-center text-muted">‡§ï‡•ã‡§à ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§®‡§π‡•Ä‡§Ç / No entries.</td></tr>
            {% endif %}
          </tbody>
        </table>
      </div>
    </div>

    <!-- Margins Paid -->
    <div class="tab-pane fade" id="margins">
      <h5 class="text-success fw-semibold mb-3"
          data-hi="üìã ‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂"
          data-en="üìã Summary">üìã ‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂</h5>

      <div class="row">
        {% for wh, total in margin_summary.items() %}
        <div class="col-md-4 mb-3">
          <div class="card border-warning shadow-sm h-100">
            <div class="card-body">
              <h6 class="card-title text-warning fw-bold">{{ wh | to_hindi }}</h6>
              <p class="mb-0 fw-semibold"
                 data-hi="‡§ï‡•Å‡§≤ ‡§¶‡•Ä ‡§ó‡§à ‡§Æ‡§æ‡§∞‡•ç‡§ú‡§ø‡§® ‚Äî {{ total | format_inr }}"
                 data-en="Total Margin Paid ‚Äî {{ total | format_inr }}">
                 ‡§ï‡•Å‡§≤ ‡§¶‡•Ä ‡§ó‡§à ‡§Æ‡§æ‡§∞‡•ç‡§ú‡§ø‡§® ‚Äî {{ total | format_inr }}
              </p>
            </div>
          </div>
        </div>
        {% endfor %}
        {% if not margin_summary %}
        <div class="col-12"><p class="text-muted small">‡§ï‡•ã‡§à ‡§°‡•á‡§ü‡§æ ‡§®‡§π‡•Ä‡§Ç / No data.</p></div>
        {% endif %}
      </div>

      <h5 class="mt-4 text-secondary fw-semibold"
          data-hi="üìÑ ‡§µ‡§ø‡§∏‡•ç‡§§‡•É‡§§ ‡§™‡•ç‡§∞‡§µ‡§ø‡§∑‡•ç‡§ü‡§ø‡§Ø‡§æ‡§Å"
          data-en="üìÑ Detailed Entries">üìÑ ‡§µ‡§ø‡§∏‡•ç‡§§‡•É‡§§ ‡§™‡•ç‡§∞‡§µ‡§ø‡§∑‡•ç‡§ü‡§ø‡§Ø‡§æ‡§Å</h5>

      <div class="table-responsive">
        <table class="table table-bordered table-striped table-hover small">
          <thead class="table-dark">
            <tr>
               <th data-hi="‡§§‡§ø‡§•‡§ø" data-en="Date">‡§§‡§ø‡§•‡§ø</th>
               <th data-hi="‡§µ‡•á‡§Ø‡§∞‡§π‡§æ‡§â‡§∏" data-en="Warehouse">‡§µ‡•á‡§Ø‡§∞‡§π‡§æ‡§â‡§∏</th>
               <th data-hi="‡§µ‡§∏‡•ç‡§§‡•Å" data-en="Commodity">‡§µ‡§∏‡•ç‡§§‡•Å</th>
               <th data-hi="‡§≠‡§∞‡•Ä ‡§ó‡§à ‡§Æ‡§æ‡§∞‡•ç‡§ú‡§ø‡§®" data-en="Margin Paid">‡§≠‡§∞‡•Ä ‡§ó‡§à ‡§Æ‡§æ‡§∞‡•ç‡§ú‡§ø‡§®</th>
            </tr>
          </thead>
          <tbody>
            {% for entry in margin_data %}
            <tr>
              <td>{{ entry.date | format_date }}</td>
              <td>{{ entry.warehouse | to_hindi }}</td>
              <td>{{ entry.commodity | to_hindi }}</td>
              <td>{{ entry.amount | format_inr }}</td>
            </tr>
            {% endfor %}
            {% if not margin_data %}
            <tr><td colspan="4" class="text-center text-muted">‡§ï‡•ã‡§à ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä ‡§®‡§π‡•Ä‡§Ç / No entries.</td></tr>
            {% endif %}
          </tbody>
        </table>
      </div>
    </div>

    <!-- Rental Due -->
    <div class="tab-pane fade" id="rental">
      <h5 class="fw-semibold mb-3 text-success"
          data-hi="üè¢ ‡§ó‡•ã‡§¶‡§æ‡§Æ ‡§ï‡§ø‡§∞‡§æ‡§Ø‡§æ ‡§¶‡•á‡§Ø <span class='fs-6'>( {{ today }} ‡§§‡§ï, ‚Çπ{{ rental_rate }}/MT/‡§¶‡§ø‡§® )</span>"
          data-en="üè¢ Rental Due <span class='fs-6'>(till {{ today }}, ‚Çπ{{ rental_rate }}/MT/day)</span>">
        üè¢ ‡§ó‡•ã‡§¶‡§æ‡§Æ ‡§ï‡§ø‡§∞‡§æ‡§Ø‡§æ ‡§¶‡•á‡§Ø <span class="fs-6">( {{ today }} ‡§§‡§ï, ‚Çπ{{ rental_rate }}/MT/‡§¶‡§ø‡§® )</span>
      </h5>
      <div class="row">
        {% for wh, comms in rental_due.items() %}
        <div class="col-md-4 mb-3">
          <div class="card border-info shadow-sm h-100">
            <div class="card-body">
              <h6 class="card-title text-info fw-bold">{{ wh | to_hindi }}</h6>
              <ul class="mb-0">
                {% for commodity, amount in comms.items() %}
                  <li>{{ commodity }} ‚Äî <strong>‚Çπ{{ "{:,.2f}".format(amount) }}</strong></li>
                {% endfor %}
              </ul>
            </div>
          </div>
        </div>
        {% else %}
          <div class="col-12">
            <p class="text-muted"
               data-hi="‡§ï‡•ã‡§à ‡§ï‡§ø‡§∞‡§æ‡§Ø‡§æ ‡§¶‡•á‡§Ø ‡§°‡•á‡§ü‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ."
               data-en="No rental due data found.">‡§ï‡•ã‡§à ‡§ï‡§ø‡§∞‡§æ‡§Ø‡§æ ‡§¶‡•á‡§Ø ‡§°‡•á‡§ü‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ.</p>
          </div>
        {% endfor %}
      </div>
    </div>

    <!-- Interest Due -->
    <div class="tab-pane fade" id="interest">
      <h5 class="fw-semibold mb-3 text-warning"
          data-hi="üí∏ ‡§¨‡•ç‡§Ø‡§æ‡§ú ‡§¶‡•á‡§Ø <span class='fs-6'>( {{ today }} ‡§§‡§ï, {{ interest_rate }}% ‡§™‡•ç‡§∞‡§§‡§ø ‡§µ‡§∞‡•ç‡§∑ )</span>"
          data-en="üí∏ Interest Due <span class='fs-6'>(till {{ today }}, {{ interest_rate }}% p.a.)</span>">
        üí∏ ‡§¨‡•ç‡§Ø‡§æ‡§ú ‡§¶‡•á‡§Ø <span class="fs-6">( {{ today }} ‡§§‡§ï, {{ interest_rate }}% ‡§™‡•ç‡§∞‡§§‡§ø ‡§µ‡§∞‡•ç‡§∑ )</span>
      </h5>
      <div class="row">
        {% for wh, amt in interest_due.items() %}
        <div class="col-md-4 mb-3">
          <div class="card border-warning shadow-sm h-100">
            <div class="card-body">
              <h6 class="card-title text-warning fw-bold">{{ wh | to_hindi }}</h6>
              <p class="mb-0"
                 data-hi="‡§¶‡•á‡§Ø ‡§¨‡•ç‡§Ø‡§æ‡§ú: <strong>‚Çπ{{ '{:,.2f}'.format(amt) }}</strong>"
                 data-en="Interest Due: <strong>‚Çπ{{ '{:,.2f}'.format(amt) }}</strong>">
                 ‡§¶‡•á‡§Ø ‡§¨‡•ç‡§Ø‡§æ‡§ú: <strong>‚Çπ{{ "{:,.2f}".format(amt) }}</strong>
              </p>
            </div>
          </div>
        </div>
        {% else %}
          <div class="col-12">
            <p class="text-muted"
               data-hi="‡§ï‡•ã‡§à ‡§¨‡•ç‡§Ø‡§æ‡§ú ‡§¶‡•á‡§Ø ‡§°‡•á‡§ü‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ."
               data-en="No interest due data found.">‡§ï‡•ã‡§à ‡§¨‡•ç‡§Ø‡§æ‡§ú ‡§¶‡•á‡§Ø ‡§°‡•á‡§ü‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ.</p>
          </div>
        {% endfor %}
      </div>
    </div>
    <!-- END tab-content -->
  </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- Language Toggle -->
<script>
(function () {
  const switcher = document.getElementById('langSwitcher');

  function applyLang(lang) {
    document.documentElement.setAttribute('lang', lang);
    // swap all elements with data-hi / data-en
    document.querySelectorAll('[data-hi]').forEach(el => {
      const txt = el.getAttribute(lang === 'hi' ? 'data-hi' : 'data-en');
      if (txt !== null) el.innerHTML = txt;
    });
    // Title
    const titleHi = '‡§∏‡•ç‡§ü‡•â‡§ï‡§ø‡§∏‡•ç‡§ü ‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§°';
    const titleEn = 'Stockist Dashboard';
    document.title = (lang === 'hi') ? titleHi : titleEn;
    try { localStorage.setItem('ui-lang', lang); } catch(e){}
  }

  // Restore saved language (default hi)
  let lang = 'hi';
  try { lang = localStorage.getItem('ui-lang') || 'hi'; } catch(e){}
  switcher.value = lang;
  applyLang(lang);

  switcher.addEventListener('change', function () {
    applyLang(this.value);
  });
})();
</script>
</body>
</html>
