<!DOCTYPE html>
<html>
<head>
    <title>Add Payment</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script>
        function fillSellerDetails() {
            const sellers = {{ sellers|tojson }};
            const name = document.getElementById('seller_name').value;
            const seller = sellers.find(s => s.name === name);
            if (seller) {
                document.getElementById('banking_name').value = seller.banking_name || '';
                document.getElementById('account_number').value = seller.account_number || '';
                document.getElementById('ifsc').value = seller.ifsc_code || '';
            } else {
                document.getElementById('banking_name').value = '';
                document.getElementById('account_number').value = '';
                document.getElementById('ifsc').value = '';
            }
        }
    </script>
</head>
<body>
<div class="container mt-4">
    <h3 class="mb-3">Add Payment</h3>
    <form method="POST">
        <div class="mb-3">
    <label>Date</label>
    <input type="date" name="date" class="form-control" required
           value="{{ request.form.get('date', '') or current_date }}">
</div>

        <div class="mb-3">
            <label>Seller Name</label>
            <select name="seller_name" id="seller_name" class="form-control" onchange="fillSellerDetails()" required>
                <option value="">Select Seller</option>
                {% for s in sellers %}
                <option value="{{ s.name }}">{{ s.name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="mb-3">
            <label>Warehouse</label>
            <input name="warehouse" class="form-control" required>
        </div>
        <div class="mb-3">
            <label>Commodity</label>
            <select name="commodity" class="form-control" required>
                <option value="Wheat">Wheat</option>
                <option value="Maize">Maize</option>
                <option value="Paddy">Paddy</option>
            </select>
        </div>
        <div class="mb-3">
            <label>Banking Name</label>
            <input name="banking_name" id="banking_name" class="form-control" required readonly>
        </div>
        <div class="mb-3">
            <label>Account Number</label>
            <input name="account_number" id="account_number" class="form-control" required readonly>
        </div>
        <div class="mb-3">
            <label>IFSC</label>
            <input name="ifsc" id="ifsc" class="form-control" required readonly>
        </div>
        <div class="mb-3">
            <label>Amount Paid</label>
            <input name="amount_paid" type="number" step="0.01" class="form-control" required>
        </div>
        <div class="mb-3">
            <label>Bank Reference</label>
            <input name="bank_reference" class="form-control" required>
        </div>
        <button class="btn btn-primary">Add Payment</button>
        <a href="{{ url_for('payment.list_payments') }}" class="btn btn-secondary">View Payments</a>
    </form>
</div>
</body>
</html>
